#!/usr/bin/env python3
"""
Visualize the Code Puppy prompt-to-output workflow.

Example: Building an Azure Dashboard
"""

WORKFLOW_DIAGRAM = """
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                    CODE PUPPY: PROMPT TO OUTPUT WORKFLOW                                  â•‘
â•‘                    Example: "Build me an Azure monitoring dashboard"                      â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘                                                                                          â•‘
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â•‘
â•‘  â”‚ STEP 1: USER INPUT                                                                 â”‚  â•‘
â•‘  â”‚ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                                                                   â”‚  â•‘
â•‘  â”‚                                                                                    â”‚  â•‘
â•‘  â”‚  User: "Build me an Azure monitoring dashboard that shows:                         â”‚  â•‘
â•‘  â”‚         - Resource health status                                                   â”‚  â•‘
â•‘  â”‚         - Cost trends over time                                                    â”‚  â•‘
â•‘  â”‚         - Alert summary"                                                           â”‚  â•‘
â•‘  â”‚                                                                                    â”‚  â•‘
â•‘  â”‚  Entry Point: cli_runner.py â†’ main.py â†’ callbacks.on_load_prompt()                 â”‚  â•‘
â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â•‘
â•‘                                           â”‚                                              â•‘
â•‘                                           â–¼                                              â•‘
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â•‘
â•‘  â”‚ STEP 2: PACK LEADER ORCHESTRATION                                                  â”‚  â•‘
â•‘  â”‚ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                                                â”‚  â•‘
â•‘  â”‚                                                                                    â”‚  â•‘
â•‘  â”‚  ğŸº Pack Leader (Tier 1: Claude Opus 4.5)                                          â”‚  â•‘
â•‘  â”‚  â””â”€â”€ Workload: ORCHESTRATOR                                                        â”‚  â•‘
â•‘  â”‚  â””â”€â”€ Failover Chain: Opus â†’ Antigravity Opus â†’ Gemini Pro â†’ Codex                  â”‚  â•‘
â•‘  â”‚                                                                                    â”‚  â•‘
â•‘  â”‚  Actions:                                                                          â”‚  â•‘
â•‘  â”‚  â”œâ”€â”€ 1. Parse user intent â†’ "Azure dashboard creation"                             â”‚  â•‘
â•‘  â”‚  â”œâ”€â”€ 2. Identify required specialists:                                             â”‚  â•‘
â•‘  â”‚  â”‚       â€¢ Husky (code generation) - for dashboard code                            â”‚  â•‘
â•‘  â”‚  â”‚       â€¢ Bloodhound (issue tracking) - for Azure API discovery                   â”‚  â•‘
â•‘  â”‚  â”‚       â€¢ Shepherd (review) - for final validation                                â”‚  â•‘
â•‘  â”‚  â”œâ”€â”€ 3. Create EpistemicStateArtifact with:                                        â”‚  â•‘
â•‘  â”‚  â”‚       Goals: ["Create Azure dashboard", "Show resource health", ...]            â”‚  â•‘
â•‘  â”‚  â”‚       Constraints: ["Use Azure SDK", "Production-ready"]                        â”‚  â•‘
â•‘  â”‚  â””â”€â”€ 4. Decompose into epics/phases                                                â”‚  â•‘
â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â•‘
â•‘                                           â”‚                                              â•‘
â•‘                                           â–¼                                              â•‘
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â•‘
â•‘  â”‚ STEP 3: WORKLOAD ROUTING & MODEL SELECTION                                         â”‚  â•‘
â•‘  â”‚ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                                       â”‚  â•‘
â•‘  â”‚                                                                                    â”‚  â•‘
â•‘  â”‚  ModelRouter checks agent assignments:                                             â”‚  â•‘
â•‘  â”‚                                                                                    â”‚  â•‘
â•‘  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚  â•‘
â•‘  â”‚  â”‚ Agent           â”‚ Workload        â”‚ Tier            â”‚ Model Chain           â”‚   â”‚  â•‘
â•‘  â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚  â•‘
â•‘  â”‚  â”‚ pack-leader     â”‚ ORCHESTRATOR    â”‚ 1 (Architect)   â”‚ Claude Opus 4.5       â”‚   â”‚  â•‘
â•‘  â”‚  â”‚ bloodhound      â”‚ LIBRARIAN       â”‚ 4 (Librarian)   â”‚ Haiku â†’ Flash â†’ GLM   â”‚   â”‚  â•‘
â•‘  â”‚  â”‚ husky           â”‚ CODING          â”‚ 5 (Sprinter)    â”‚ Cerebras GLM 4.7      â”‚   â”‚  â•‘
â•‘  â”‚  â”‚ shepherd        â”‚ REASONING       â”‚ 2 (Builder-Hi)  â”‚ Sonnet â†’ Antigravity  â”‚   â”‚  â•‘
â•‘  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚  â•‘
â•‘  â”‚                                                                                    â”‚  â•‘
â•‘  â”‚  Rate Limit Check (PROACTIVE - GLM-Token-Saver pattern):                           â”‚  â•‘
â•‘  â”‚  â”œâ”€â”€ Check x-ratelimit-remaining-tokens-minute headers                             â”‚  â•‘
â•‘  â”‚  â”œâ”€â”€ If < 20% remaining â†’ trigger proactive failover                               â”‚  â•‘
â•‘  â”‚  â””â”€â”€ Emit Logfire telemetry: rate_limit_approaching                                â”‚  â•‘
â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â•‘
â•‘                                           â”‚                                              â•‘
â•‘                                           â–¼                                              â•‘
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â•‘
â•‘  â”‚ STEP 4: PARALLEL AGENT EXECUTION                                                   â”‚  â•‘
â•‘  â”‚ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                                                 â”‚  â•‘
â•‘  â”‚                                                                                    â”‚  â•‘
â•‘  â”‚  Phase 1: Discovery (Parallel)                                                     â”‚  â•‘
â•‘  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚  â•‘
â•‘  â”‚  â”‚ ğŸ• Bloodhound (LIBRARIAN tier - Haiku)                                      â”‚   â”‚  â•‘
â•‘  â”‚  â”‚ â””â”€â”€ Task: "Find Azure Monitor SDK patterns"                                 â”‚   â”‚  â•‘
â•‘  â”‚  â”‚ â””â”€â”€ Tools: semantic_search, file_search, grep_search                        â”‚   â”‚  â•‘
â•‘  â”‚  â”‚ â””â”€â”€ Output: Azure SDK docs, example patterns, API references                â”‚   â”‚  â•‘
â•‘  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚  â•‘
â•‘  â”‚                                                                                    â”‚  â•‘
â•‘  â”‚  Phase 2: Code Generation (Sequential)                                             â”‚  â•‘
â•‘  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚  â•‘
â•‘  â”‚  â”‚ ğŸº Husky (CODING tier - Cerebras GLM 4.7 @ 1500+ tokens/sec)                â”‚   â”‚  â•‘
â•‘  â”‚  â”‚ â””â”€â”€ Task: "Generate Azure dashboard Bicep/Python code"                      â”‚   â”‚  â•‘
â•‘  â”‚  â”‚ â””â”€â”€ Input: Bloodhound's discovery + user requirements                       â”‚   â”‚  â•‘
â•‘  â”‚  â”‚ â””â”€â”€ Tools: create_file, replace_string_in_file, run_in_terminal             â”‚   â”‚  â•‘
â•‘  â”‚  â”‚ â””â”€â”€ Token Budget: 300K/min, tracking via TokenBudgetManager                 â”‚   â”‚  â•‘
â•‘  â”‚  â”‚                                                                             â”‚   â”‚  â•‘
â•‘  â”‚  â”‚ âš¡ Rate Limit Header Tracking:                                               â”‚   â”‚  â•‘
â•‘  â”‚  â”‚    Response headers: x-ratelimit-remaining-tokens-minute: 280000            â”‚   â”‚  â•‘
â•‘  â”‚  â”‚    â†’ RateLimitTracker.update_from_response("cerebras", headers)             â”‚   â”‚  â•‘
â•‘  â”‚  â”‚    â†’ is_near_limit(0.2) = False (93% remaining, healthy âœ…)                  â”‚   â”‚  â•‘
â•‘  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚  â•‘
â•‘  â”‚                                                                                    â”‚  â•‘
â•‘  â”‚  Files Created:                                                                    â”‚  â•‘
â•‘  â”‚  â”œâ”€â”€ azure-dashboard/                                                              â”‚  â•‘
â•‘  â”‚  â”‚   â”œâ”€â”€ main.bicep                    (Azure infrastructure)                      â”‚  â•‘
â•‘  â”‚  â”‚   â”œâ”€â”€ dashboard.py                  (Dashboard logic)                           â”‚  â•‘
â•‘  â”‚  â”‚   â”œâ”€â”€ requirements.txt              (Dependencies)                              â”‚  â•‘
â•‘  â”‚  â”‚   â””â”€â”€ tests/test_dashboard.py       (Unit tests)                                â”‚  â•‘
â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â•‘
â•‘                                           â”‚                                              â•‘
â•‘                                           â–¼                                              â•‘
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â•‘
â•‘  â”‚ STEP 5: VERIFICATION (Ralph Loop)                                                  â”‚  â•‘
â•‘  â”‚ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                                                â”‚  â•‘
â•‘  â”‚                                                                                    â”‚  â•‘
â•‘  â”‚  ğŸ• Shepherd (REASONING tier - Claude Sonnet 4.5)                                  â”‚  â•‘
â•‘  â”‚  â””â”€â”€ Workload: REASONING                                                           â”‚  â•‘
â•‘  â”‚  â””â”€â”€ Failover: Sonnet â†’ Antigravity Sonnet â†’ Gemini Pro â†’ GLM                      â”‚  â•‘
â•‘  â”‚                                                                                    â”‚  â•‘
â•‘  â”‚  Verification Steps:                                                               â”‚  â•‘
â•‘  â”‚  â”œâ”€â”€ 1. Static Analysis: Check Bicep syntax, Python types                          â”‚  â•‘
â•‘  â”‚  â”œâ”€â”€ 2. Drift Detection: Compare output vs EpistemicStateArtifact.goals            â”‚  â•‘
â•‘  â”‚  â”‚       âœ“ "Create Azure dashboard" â†’ main.bicep exists                            â”‚  â•‘
â•‘  â”‚  â”‚       âœ“ "Show resource health" â†’ ResourceHealthClient in dashboard.py           â”‚  â•‘
â•‘  â”‚  â”‚       âœ“ "Cost trends" â†’ CostManagementClient in dashboard.py                    â”‚  â•‘
â•‘  â”‚  â”‚       âœ“ "Alert summary" â†’ AlertsManagementClient in dashboard.py                â”‚  â•‘
â•‘  â”‚  â”œâ”€â”€ 3. Run Tests: pytest tests/test_dashboard.py                                  â”‚  â•‘
â•‘  â”‚  â””â”€â”€ 4. Spec Compliance: Azure best practices check                                â”‚  â•‘
â•‘  â”‚                                                                                    â”‚  â•‘
â•‘  â”‚  Result: PASS âœ… â†’ Continue to output                                              â”‚  â•‘
â•‘  â”‚          FAIL âŒ â†’ Retry with Pack Leader (loop back to Step 2)                    â”‚  â•‘
â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â•‘
â•‘                                           â”‚                                              â•‘
â•‘                                           â–¼                                              â•‘
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â•‘
â•‘  â”‚ STEP 6: OUTPUT & COMPLETION                                                        â”‚  â•‘
â•‘  â”‚ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                                                       â”‚  â•‘
â•‘  â”‚                                                                                    â”‚  â•‘
â•‘  â”‚  Final Response to User:                                                           â”‚  â•‘
â•‘  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â•‘
â•‘  â”‚  â”‚ âœ… Azure monitoring dashboard created!                                       â”‚  â”‚  â•‘
â•‘  â”‚  â”‚                                                                              â”‚  â”‚  â•‘
â•‘  â”‚  â”‚ Files created:                                                               â”‚  â”‚  â•‘
â•‘  â”‚  â”‚ â€¢ azure-dashboard/main.bicep - Infrastructure as Code                        â”‚  â”‚  â•‘
â•‘  â”‚  â”‚ â€¢ azure-dashboard/dashboard.py - Dashboard with 3 panels:                    â”‚  â”‚  â•‘
â•‘  â”‚  â”‚   - Resource Health Status                                                   â”‚  â”‚  â•‘
â•‘  â”‚  â”‚   - Cost Trends Chart                                                        â”‚  â”‚  â•‘
â•‘  â”‚  â”‚   - Alert Summary Widget                                                     â”‚  â”‚  â•‘
â•‘  â”‚  â”‚                                                                              â”‚  â”‚  â•‘
â•‘  â”‚  â”‚ To deploy:                                                                   â”‚  â”‚  â•‘
â•‘  â”‚  â”‚   az deployment group create --template-file main.bicep                      â”‚  â”‚  â•‘
â•‘  â”‚  â”‚   python dashboard.py --subscription $AZURE_SUBSCRIPTION_ID                  â”‚  â”‚  â•‘
â•‘  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â•‘
â•‘  â”‚                                                                                    â”‚  â•‘
â•‘  â”‚  Telemetry Emitted (Logfire):                                                      â”‚  â•‘
â•‘  â”‚  â”œâ”€â”€ task_completed: duration=12.3s, tokens_used=45000, cost=$0.12                 â”‚  â•‘
â•‘  â”‚  â”œâ”€â”€ models_used: [opus, haiku, glm-4.7, sonnet]                                   â”‚  â•‘
â•‘  â”‚  â”œâ”€â”€ rate_limit_state: cerebras=93% remaining, healthy                             â”‚  â•‘
â•‘  â”‚  â””â”€â”€ verification_result: PASS, drift_score=0.0                                    â”‚  â•‘
â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â•‘
â•‘                                                                                          â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                              RATE LIMIT FAILOVER SCENARIO
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

If during Step 4, Cerebras hits rate limits:

  Response Headers: x-ratelimit-remaining-tokens-minute: 45000  (15% remaining)
  
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ RateLimitTracker.is_near_limit(threshold=0.2)                                       â”‚
  â”‚ â””â”€â”€ Returns: (True, "âš ï¸ Token limit approaching: 45,000/300,000 (15% remaining)")   â”‚
  â”‚                                                                                     â”‚
  â”‚ RateLimitFailover.get_failover_model("Cerebras-GLM-4.7")                            â”‚
  â”‚ â””â”€â”€ Returns: "claude-code-claude-haiku-4-5-20251001"                                â”‚
  â”‚                                                                                     â”‚
  â”‚ Logfire Telemetry:                                                                  â”‚
  â”‚ â””â”€â”€ rate_limit_approaching: provider=cerebras, remaining_pct=15%, threshold=20%    â”‚
  â”‚ â””â”€â”€ rate_limit_fallback_triggered: provider=cerebras, cooldown=60s                 â”‚
  â”‚                                                                                     â”‚
  â”‚ Request automatically routed to Haiku â†’ continues execution seamlessly              â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                                    KEY MODULES INVOLVED
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  Input Layer:
  â”œâ”€â”€ cli_runner.py              â†’ Entry point, prompt capture
  â”œâ”€â”€ callbacks.py               â†’ on_load_prompt(), prompt additions
  â””â”€â”€ main.py                    â†’ Agent initialization
  
  Orchestration:
  â”œâ”€â”€ agents/pack_leader.py      â†’ Master orchestrator (ORCHESTRATOR workload)
  â”œâ”€â”€ core/pack_governor.py      â†’ Agent role classification
  â””â”€â”€ epistemic/state.py         â†’ EpistemicStateArtifact (goals, hypotheses)
  
  Model Routing:
  â”œâ”€â”€ core/failover_config.py    â†’ WORKLOAD_CHAINS, AGENT_WORKLOAD_REGISTRY â˜… NEW
  â”œâ”€â”€ core/model_router.py       â†’ Tier detection, model selection
  â”œâ”€â”€ core/rate_limit_failover.py â†’ Automatic failover on 429s
  â””â”€â”€ core/token_budget.py       â†’ Budget tracking, provider limits
  
  Proactive Rate Limiting (GLM-Token-Saver):
  â”œâ”€â”€ core/rate_limit_headers.py â†’ Header parsing, 20% threshold â˜… NEW
  â””â”€â”€ http_utils.py              â†’ RetryingAsyncClient with header tracking
  
  Agent Execution:
  â”œâ”€â”€ agents/base_agent.py       â†’ BaseAgent ABC, tool registration
  â”œâ”€â”€ agents/husky.py            â†’ Code generation (CODING workload)
  â”œâ”€â”€ agents/bloodhound.py       â†’ Issue tracking (LIBRARIAN workload)
  â””â”€â”€ agents/shepherd.py         â†’ Code review (REASONING workload)
  
  Verification:
  â”œâ”€â”€ core/ralph_loop.py         â†’ Belief vs execution validation
  â””â”€â”€ plugins/shell_safety/      â†’ Command approval, safety checks
  
  Output:
  â”œâ”€â”€ messaging/message_bus.py   â†’ Response streaming
  â””â”€â”€ tools/display.py           â†’ Rich formatting
"""

def main():
    print(WORKFLOW_DIAGRAM)


if __name__ == "__main__":
    main()
